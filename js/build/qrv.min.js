function secondsToTime(a){var b=Math.floor(a/3600),c=Math.floor((a-3600*b)/60),d=Math.floor(a-3600*b-60*c);return 10>b&&(b="0"+b),10>c&&(c="0"+c),10>d&&(d="0"+d),b&&(b="00"),b+":"+c+":"+d}function bytesToSize(a){var b=["Bytes","KB","MB"];if(0==a)return"n/a";var c=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return(a/Math.pow(1024,c)).toFixed(1)+" "+b[c]}function fileSelected(){document.getElementById("upload_response").style.display="none",document.getElementById("error").style.display="none",document.getElementById("error2").style.display="none",document.getElementById("abort").style.display="none",document.getElementById("warnsize").style.display="none";var a=document.getElementById("image_file").files[0],b=/^(image\/bmp|image\/gif|image\/jpeg|image\/png|image\/tiff)$/i;if(!b.test(a.type))return void(document.getElementById("error").style.display="block");if(a.size>iMaxFilesize)return void(document.getElementById("warnsize").style.display="block");var c=document.getElementById("preview"),d=new FileReader;d.onload=function(b){c.src=b.target.result,c.onload=function(){sResultFileSize=bytesToSize(a.size),document.getElementById("fileinfo").style.display="block",document.getElementById("filename").innerHTML="Name: "+a.name,document.getElementById("filesize").innerHTML="Size: "+sResultFileSize,document.getElementById("filetype").innerHTML="Type: "+a.type,document.getElementById("filedim").innerHTML="Dimension: "+c.naturalWidth+" x "+c.naturalHeight}},d.readAsDataURL(a)}function startUploading(){iPreviousBytesLoaded=0,document.getElementById("upload_response").style.display="none",document.getElementById("error").style.display="none",document.getElementById("error2").style.display="none",document.getElementById("abort").style.display="none",document.getElementById("warnsize").style.display="none",document.getElementById("progress_percent").innerHTML="";var a=document.getElementById("progress");a.style.display="block",a.style.width="0px";var b=new FormData(document.getElementById("upload_form")),c=new XMLHttpRequest;c.upload.addEventListener("progress",uploadProgress,!1),c.addEventListener("load",uploadFinish,!1),c.addEventListener("error",uploadError,!1),c.addEventListener("abort",uploadAbort,!1),c.open("POST","php/upload.php"),c.send(b),oTimer=setInterval(doInnerUpdates,300)}function doInnerUpdates(){var a=iBytesUploaded,b=a-iPreviousBytesLoaded;if(0!=b){iPreviousBytesLoaded=a,b=2*b;var c=iBytesTotal-iPreviousBytesLoaded,d=c/b,e=b.toString()+"B/s";b>1048576?e=(Math.round(100*b/1048576)/100).toString()+"MB/s":b>1024&&(e=(Math.round(100*b/1024)/100).toString()+"KB/s"),document.getElementById("speed").innerHTML=e,document.getElementById("remaining").innerHTML="| "+secondsToTime(d)}}function uploadProgress(a){if(a.lengthComputable){iBytesUploaded=a.loaded,iBytesTotal=a.total;var b=Math.round(100*a.loaded/a.total),c=bytesToSize(iBytesUploaded);if(document.getElementById("progress_percent").innerHTML=b.toString()+"%",document.getElementById("progress").style.width=(2*b).toString()+"px",document.getElementById("b_transfered").innerHTML=c,100==b){var d=document.getElementById("upload_response");d.innerHTML="<h1>Please wait...processing</h1>",d.style.display="block"}}else document.getElementById("progress").innerHTML="unable to compute"}function uploadFinish(a){var b=document.getElementById("upload_response");b.innerHTML=a.target.responseText,b.style.display="block",document.getElementById("progress_percent").innerHTML="100%",document.getElementById("progress").style.width="100px",document.getElementById("filesize").innerHTML=sResultFileSize,document.getElementById("remaining").innerHTML="| 00:00:00",clearInterval(oTimer)}function uploadError(a){document.getElementById("error2").style.display="block",clearInterval(oTimer)}function uploadAbort(a){document.getElementById("abort").style.display="block",clearInterval(oTimer)}var app=angular.module("mainApp",["ngRoute","ui.bootstrap","ngSanitize"]);app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/Search",{templateUrl:"template/search.html",controller:"searchController"}).when("/Show/:animalID",{templateUrl:"template/show.html",controller:"showController"}).when("/Assistance",{templateUrl:"template/assist.html",controller:"assistController"}).when("/Adresse",{templateUrl:"template/adresse.html",controller:"adresseController"}).when("/Login",{templateUrl:"template/login.html",controller:"loginController"}).when("/Image",{templateUrl:"template/image.html",controller:"imageController"}).when("/Edit",{templateUrl:"template/edit.html",controller:"editController"}).when("/New",{templateUrl:"template/new.html",controller:"newController"}).when("/Info/:idInfo",{templateUrl:"template/info.html",controller:"infoController"}).when("/Contact",{templateUrl:"template/contact.html",controller:"contactController"}).otherwise({redirectTo:"/Search"})}]),app.filter("makeUppercase",function(){return function(a){return a.toUpperCase()}}),app.run(["$rootScope","$location","$window",function(a,b,c){a.$on("$routeChangeSuccess",function(a){c.ga&&c.ga("send","pageview",{page:b.path()})}),a.historiqueDone=0,a.needReload=!1,a.codepin="",a.nuserie="",a.email_proprio="",a.login_menu="Connexion",a.bFirst=0,a.bLogin=0,a.valide=!1}]),app.directive("rotate",function(){return{restrict:"A",link:function(a,b,c){a.$watch(c.degrees,function(a){var c="rotate("+a+"deg)";b.css({"-moz-transform":c,"-webkit-transform":c,"-o-transform":c,"-ms-transform":c})})}}}),app.directive("capitalizeAll",["$parse",function(a){return{require:"ngModel",link:function(b,c,d,e){var f=function(a){if(angular.isUndefined(a))return"";var b=a.toUpperCase();return b!==a&&(e.$setViewValue(b),e.$render()),b},g=a(d.ngModel);e.$parsers.push(f),f(g(b))}}}]),app.directive("capitalizeFirst",["$parse",function(a){return{require:"ngModel",link:function(b,c,d,e){var f=function(a){if(angular.isUndefined(a))return"";var b=a.charAt(0).toUpperCase()+a.substring(1);return b!==a&&(e.$setViewValue(b),e.$render()),b},g=a(d.ngModel);e.$parsers.push(f),f(g(b))}}}]),app.filter("telephoneFilter",function(){return function(a){if(angular.isUndefined(a))return"";var b=a.trim(),c="";if(10==b.length)for(i=0;i<10;i++)c+=b.charAt(i),i>0&&i%2==1&&9!=i&&(c+=" ");else c=b;return c}}),app.controller("adresseController",["$rootScope","$scope","$http","$location",function(a,b,c,d){b.send=!1,b.email_proprio=a.email_proprio,b.updateAdresse=function(){jsn={codepin:a.codepin,email_proprio:b.email_proprio},c.post("php/updateAdresseMail.php",jsn).success(function(a){obj=angular.fromJson(a),"ok"==obj.ret&&(b.send=!0)}).error(function(a){b.message="Anomalie. Echec de la mise à jour"})},b.closeAdresse=function(){new_url="/Show/"+a.codepin,d.path(new_url)}}]),app.controller("assistController",["$rootScope","$scope","$http","$routeParams",function(a,b,c,d){}]),app.controller("contactController",["$rootScope","$scope","$http","$location",function(a,b,c,d){b.codepin=a.codepin,b.email_proprio=a.email_proprio,b.send=!1,b.sendMail=function(){jsn={codepin:a.codepin,obj:b.objet,message:b.message},c.post("php/send_mail_to_vethica.php",jsn).success(function(a){b.send=!0})},b.closeMail=function(){new_url="/Show/"+a.codepin,d.path(new_url)}}]),app.controller("editController",["$rootScope","$scope","$http","$location",function(a,b,c,d){b.password_proprio2="",b.password_proprio1="",b.info="Modification",editAnimal=function(){c.post("php/searchData.php",{val:a.codepin}).success(function(c,e){obj=angular.fromJson(c),b.id_animal=obj.id_animal,b.status=e,b.data=c,0==obj.id_animal?(new_url="/New/"+a.codepin,d.path(new_url)):(obj=angular.fromJson(c),b.id_animal=obj.id_animal,b.codepin=obj.codepin,b.nuserie=obj.nuserie,b.email_proprio=obj.email_proprio,b.nom_animal=obj.nom_animal,b.nom_proprio=obj.nom_proprio,b.prenom_proprio=obj.prenom_proprio,b.tel_proprio=obj.tel_proprio,b.code_postal=obj.code_postal,b.espece=obj.espece,b.date_naissance=obj.date_naissance,b.race=obj.race)}).error(function(a,c){b.data=a||"Request failed",b.status=c,b.nom_animal="erreur"})},b.updateForm=function(){jsn={codepin:b.codepin,nuserie:b.nuserie,email_proprio:b.email_proprio,password_proprio:b.password_proprio,nom_proprio:b.nom_proprio,prenom_proprio:b.prenom_proprio,tel_proprio:b.tel_proprio,nom_animal:b.nom_animal,code_postal:b.code_postal,espece:b.espece,date_naissance:b.date_naissance,race:b.race},c.post("php/updateData.php",jsn).success(function(a){new_url="/Show/"+b.codepin,d.path(new_url)}).error(function(a){b.message="Erreur update"})},editAnimal(),b.change_password=function(){b.mess=""},b.do_change_password=function(){return b.mess="",b.password_proprio1!=b.password_proprio2?(b.mess="Vos saisies ne sont pas identiques... Recommencez",b.password_proprio2="",void(b.password_proprio1="")):""!=b.password_proprio1?(b.password_proprio=b.password_proprio1,jsn={codepin:a.codepin,password_proprio:b.password_proprio},c.post("php/updatePassword.php",jsn),void $("#passwordModal").modal("hide")):void 0}}]),app.controller("imageController",["$rootScope","$scope",function(a,b){b.nuserie=a.nuserie,b.codepin=a.codepin}]);var iBytesUploaded=0,iBytesTotal=0,iPreviousBytesLoaded=0,iMaxFilesize=4194304,oTimer=0,sResultFileSize="";app.controller("infoController",["$rootScope","$scope","$http","$routeParams","$location",function(a,b,c,d,e){id=d.idInfo,1==id&&(b.message_red="Insertion impossible"),2==id&&(b.message_red="Mise à jour  impossible"),3==id&&(b.message_red="Code erroné. 7 caractères pour code PIN ou 15 caractères pour code ISO"),4==id&&(b.message_red="Impossible de créer un code ISO sans code PIN"),5==id&&(b.message_red="QRV inexistant. Vérifiez les 7 caractères sur votre médaille")}]),app.controller("loginController",["$rootScope","$scope","$http","$location",function(a,b,c,d){b.processLogin=function(){jsn={codepin:a.codepin,password:b.password},c.post("php/login.php",jsn).success(function(c){return 0!=c.error?(a.login_menu="Connexion",a.bLogin=0,void(b.mess="Mot de passe incorrect")):(a.login_menu="Déconnection",a.bLogin=1,new_url="/Show/"+a.codepin,void d.path(new_url))}).error(function(b){a.bLogin=0})},input_password=function(){b.mess=""},b.send_password=function(){jsn={codepin:a.codepin},c.post("php/send_password.php",jsn).success(function(a){b.mess="Mot de passe envoyé. Consultez votre messagerie"}).error(function(a){b.mess="Erreur sur envoi Mot de passe"})}}]),app.controller("newController",["$rootScope","$scope","$http","$location",function(a,b,c,d){function e(a,b,c){jsn={codepin:a.codepin},c.post("php/search_nuserie.php",jsn).success(function(c){obj=angular.fromJson(c),0==obj.ret?(a.nuserie=obj.nuserie,b.codepin=a.codepin,b.nuserie=a.nuserie):nuserie_readonly=!1})}b.isNuserieReadOnly=function(){return nuserie_readonly},b.processForm=function(){b.password_proprio=$("#password_proprio").val(),jsn={codepin:b.codepin,nuserie:b.nuserie,email_proprio:b.email_proprio,password_proprio:b.password_proprio,nom_proprio:b.nom_proprio,prenom_proprio:b.prenom_proprio,tel_proprio:b.tel_proprio,nom_animal:b.nom_animal,code_postal:b.code_postal,espece:b.espece,date_naissance:b.date_naissance,race:b.race},c.post("php/mail_new_user.php",jsn).success(function(c){obj=angular.fromJson(c),"ok"==obj.ret?(b.message="Mail envoyé",new_url="/Show/"+b.codepin,a.needReload=!0,d.path(new_url)):d.path("/Info/1")}).error(function(a){b.message="Mail NON envoyé"})},b.email_proprio="",nuserie_readonly=!0,e(a,b,c)}]),app.controller("searchController",["$rootScope","$scope","$http","$routeParams","$location",function(a,b,c,d,e){b.processSearch=function(){new_url="/Show/"+b.str_search,e.path(new_url)},count_tuple=function(){c.post("php/count_qrcode.php").success(function(a,c){obj=angular.fromJson(a),b.cc1=obj.cc1,b.cc2=obj.cc2})},count_tuple()}]),app.controller("showController",["$rootScope","$scope","$http","$routeParams","$location","$window",function(a,b,c,d,e,f){a.valide=!0,b.image_name="../img/chien-1",b.rotate_value=0,b.status_ready=!1,refresh=function(){f.location.reload(),a.needReload=!1},unLogin=function(){a.bLogin=0,a.$apply()},b.message_red="",a.needReload&&refresh(),searchAnimal=function(){a.codepin=d.animalID,c.post("php/searchData.php",{val:d.animalID}).success(function(d,f){return b.info=d,obj=angular.fromJson(d),b.id_animal=obj.id_animal,b.status=f,b.data=d,200==obj.error?void e.path("/Info/3"):400==obj.error?void e.path("/Info/4"):500==obj.error?void e.path("/Info/5"):void(300==obj.error?(a.bFirst=1,b.nuserie=obj.nuserie,a.nuserie=obj.nuserie,b.codepin=obj.codepin,a.codepin=obj.codepin):(a.historiqueDone||(a.historiqueDone=1,c.post("php/historique.php",{val:obj.codepin}).success(function(a,b){})),b.status_ready=!0,b.id_animal=obj.id_animal,b.codepin=obj.codepin,b.nuserie=obj.nuserie,b.nom_animal=obj.nom_animal,b.email_proprio=obj.email_proprio,b.nom_proprio=obj.nom_proprio,b.prenom_proprio=obj.prenom_proprio,b.tel_proprio=obj.tel_proprio,b.image_name=obj.image_name,b.rotate_value=obj.rotate_image,a.nuserie=b.nuserie,a.codepin=b.codepin,a.email_proprio=b.email_proprio,1==obj.keepLogin&&(a.login_menu="Déconnection",a.bLogin=1),0==obj.etat?(a.valide=!1,b.message_red="<strong>Votre compte est enregistré.</strong><br>Vous avez reçu un courriel contenant un lien pour valider et compléter votre compte.<h5><small>Ce lien est valable 7 jours</small></h5>"):(a.valide=!0,b.message_red="")))}).error(function(a,c){b.data=a||"Request failed",b.status=c,b.status_ready=!1,b.nom_animal="Please wait..."})},b.isFirst=function(){return a.bFirst?!0:!1},b.isValide=function(){return a.valide?!0:!1},b.canConnect=function(){return a.bFirst?!1:a.valide?a.bLogin?!1:!0:!1},b.isLogin=function(){return a.bLogin?!0:!1},b.isReady=function(){return angular.isUndefined(b.status_ready)?!1:(val=b.image_name,b.status_ready)},b.rotate_image=function(){b.rotate_value=parseInt(b.rotate_value)+90,360==b.rotate_value&&(b.rotate_value=0),c.post("php/rotateImage.php",{val:a.codepin,rotate:b.rotate_value})},searchAnimal()}]);